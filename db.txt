-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.action_skills (
  action character varying NOT NULL,
  skill character varying NOT NULL,
  description text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT action_skills_pkey PRIMARY KEY (action)
);
CREATE TABLE public.chunks (
  id text NOT NULL,
  x integer NOT NULL,
  y integer NOT NULL,
  data jsonb NOT NULL,
  version integer NOT NULL,
  created_at timestamp without time zone,
  updated_at timestamp without time zone,
  last_accessed timestamp without time zone,
  CONSTRAINT chunks_pkey PRIMARY KEY (id)
);
CREATE TABLE public.experience_logs (
  id integer NOT NULL DEFAULT nextval('experience_logs_id_seq'::regclass),
  player_pda character varying NOT NULL,
  skill character varying NOT NULL CHECK (skill::text = ANY (ARRAY['attack'::character varying, 'strength'::character varying, 'defense'::character varying, 'magic'::character varying, 'projectiles'::character varying, 'vitality'::character varying, 'mining'::character varying, 'woodcutting'::character varying, 'fishing'::character varying, 'farming'::character varying, 'hunting'::character varying, 'smithing'::character varying, 'crafting'::character varying, 'cooking'::character varying, 'alchemy'::character varying, 'construction'::character varying, 'luck'::character varying]::text[])),
  experience_gain integer NOT NULL CHECK (experience_gain > 0),
  source character varying,
  timestamp timestamp with time zone DEFAULT now(),
  session_id uuid,
  game_mode character varying,
  additional_data jsonb,
  asset_id text,
  CONSTRAINT experience_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.map_editor_animations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  asset_id text NOT NULL UNIQUE,
  frame_width integer NOT NULL,
  frame_height integer NOT NULL,
  margin integer NOT NULL DEFAULT 0,
  spacing integer NOT NULL DEFAULT 0,
  clips jsonb NOT NULL DEFAULT '[]'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  version integer NOT NULL DEFAULT 1,
  CONSTRAINT map_editor_animations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.map_editor_collisions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  object_id text NOT NULL,
  placed_object_id text NOT NULL UNIQUE,
  world_name text NOT NULL,
  chunk_x integer NOT NULL,
  chunk_y integer NOT NULL,
  collision_tiles ARRAY DEFAULT '{}'::text[],
  above_tiles ARRAY DEFAULT '{}'::text[],
  below_tiles ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  version integer NOT NULL DEFAULT 1,
  interaction_tiles ARRAY DEFAULT '{}'::text[],
  CONSTRAINT map_editor_collisions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.map_saves (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id text NOT NULL DEFAULT 'default-user'::text,
  world_name text NOT NULL DEFAULT 'obelisk_world'::text,
  map_name text NOT NULL,
  description text,
  base_chunk_id text,
  base_chunk_name text,
  base_chunk_image_path text,
  chunk_size integer NOT NULL DEFAULT 64,
  world_width integer NOT NULL DEFAULT 2048,
  world_height integer NOT NULL DEFAULT 2048,
  camera_x integer NOT NULL DEFAULT 1024,
  camera_y integer NOT NULL DEFAULT 1024,
  scale real NOT NULL DEFAULT 1.0,
  placed_objects jsonb NOT NULL DEFAULT '[]'::jsonb,
  is_public boolean DEFAULT false,
  tags ARRAY DEFAULT '{}'::text[],
  version integer DEFAULT 1,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  animation_stats jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT map_saves_pkey PRIMARY KEY (id)
);
CREATE TABLE public.nft_skill_experience (
  asset_id text NOT NULL,
  skill text NOT NULL CHECK (skill = ANY (ARRAY['attack'::text, 'strength'::text, 'defense'::text, 'magic'::text, 'projectiles'::text, 'vitality'::text, 'mining'::text, 'woodcutting'::text, 'fishing'::text, 'farming'::text, 'hunting'::text, 'smithing'::text, 'crafting'::text, 'cooking'::text, 'alchemy'::text, 'construction'::text, 'luck'::text])),
  experience bigint NOT NULL DEFAULT 0 CHECK (experience >= 0),
  level integer NOT NULL DEFAULT 1 CHECK (level >= 1 AND level <= 99),
  pending_onchain_update boolean NOT NULL DEFAULT false,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT nft_skill_experience_pkey PRIMARY KEY (asset_id, skill)
);
CREATE TABLE public.nfts (
  asset_id text NOT NULL,
  player_pda text,
  name text NOT NULL,
  level integer NOT NULL DEFAULT 1,
  combat_level integer NOT NULL DEFAULT 1,
  total_level integer NOT NULL DEFAULT 9,
  version text NOT NULL DEFAULT '2.0.0'::text,
  attack integer NOT NULL DEFAULT 1,
  strength integer NOT NULL DEFAULT 1,
  defense integer NOT NULL DEFAULT 1,
  magic integer NOT NULL DEFAULT 1,
  projectiles integer NOT NULL DEFAULT 1,
  vitality integer NOT NULL DEFAULT 1,
  crafting integer NOT NULL DEFAULT 1,
  luck integer NOT NULL DEFAULT 1,
  last_arweave_uri text,
  last_update_sig text,
  state_version integer NOT NULL DEFAULT 0,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  mining integer DEFAULT 1 CHECK (mining >= 1 AND mining <= 99),
  woodcutting integer DEFAULT 1 CHECK (woodcutting >= 1 AND woodcutting <= 99),
  fishing integer DEFAULT 1 CHECK (fishing >= 1 AND fishing <= 99),
  farming integer DEFAULT 1 CHECK (farming >= 1 AND farming <= 99),
  hunting integer DEFAULT 1 CHECK (hunting >= 1 AND hunting <= 99),
  smithing integer DEFAULT 1 CHECK (smithing >= 1 AND smithing <= 99),
  cooking integer DEFAULT 1 CHECK (cooking >= 1 AND cooking <= 99),
  alchemy integer DEFAULT 1 CHECK (alchemy >= 1 AND alchemy <= 99),
  construction integer DEFAULT 1 CHECK (construction >= 1 AND construction <= 99),
  CONSTRAINT nfts_pkey PRIMARY KEY (asset_id)
);
CREATE TABLE public.pda_creation_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  player_id uuid NOT NULL,
  pda_address text NOT NULL,
  creation_cost numeric NOT NULL,
  game_wallet_signature text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT pda_creation_log_pkey PRIMARY KEY (id),
  CONSTRAINT pda_creation_log_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.player_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  player_id uuid NOT NULL,
  item_definition_id text NOT NULL,
  cnft_address text NOT NULL UNIQUE,
  quantity integer NOT NULL DEFAULT 1 CHECK (quantity > 0),
  minted_at timestamp with time zone DEFAULT now(),
  mint_cost numeric DEFAULT 0,
  mint_signature text NOT NULL,
  metadata_uri text,
  rarity text,
  item_type text,
  is_stacked boolean DEFAULT false,
  current_durability integer,
  acquisition_source text DEFAULT 'game_reward'::text,
  found_in_dungeon text,
  found_on_floor integer,
  last_traded_at timestamp with time zone,
  traded_to_player uuid,
  withdrawn_to_wallet text,
  withdrawn_at timestamp with time zone,
  CONSTRAINT player_items_pkey PRIMARY KEY (id),
  CONSTRAINT player_items_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.profiles(id),
  CONSTRAINT player_items_traded_to_player_fkey FOREIGN KEY (traded_to_player) REFERENCES public.profiles(id)
);
CREATE TABLE public.player_skill_experience (
  player_pda character varying NOT NULL,
  combat_xp bigint DEFAULT 0 CHECK (combat_xp >= 0),
  magic_xp bigint DEFAULT 0 CHECK (magic_xp >= 0),
  crafting_xp bigint DEFAULT 0 CHECK (crafting_xp >= 0),
  exploration_xp bigint DEFAULT 0 CHECK (exploration_xp >= 0),
  gambling_xp bigint DEFAULT 0 CHECK (gambling_xp >= 0),
  combat_level integer DEFAULT 1 CHECK (combat_level >= 1 AND combat_level <= 120),
  magic_level integer DEFAULT 1 CHECK (magic_level >= 1 AND magic_level <= 120),
  crafting_level integer DEFAULT 1 CHECK (crafting_level >= 1 AND crafting_level <= 120),
  exploration_level integer DEFAULT 1 CHECK (exploration_level >= 1 AND exploration_level <= 120),
  gambling_level integer DEFAULT 1 CHECK (gambling_level >= 1 AND gambling_level <= 120),
  last_onchain_sync timestamp with time zone DEFAULT now(),
  pending_onchain_update boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  attack_xp bigint DEFAULT 0 CHECK (attack_xp >= 0),
  strength_xp bigint DEFAULT 0 CHECK (strength_xp >= 0),
  defense_xp bigint DEFAULT 0 CHECK (defense_xp >= 0),
  projectiles_xp bigint DEFAULT 0 CHECK (projectiles_xp >= 0),
  vitality_xp bigint DEFAULT 0 CHECK (vitality_xp >= 0),
  mining_xp bigint DEFAULT 0 CHECK (mining_xp >= 0),
  woodcutting_xp bigint DEFAULT 0 CHECK (woodcutting_xp >= 0),
  fishing_xp bigint DEFAULT 0 CHECK (fishing_xp >= 0),
  farming_xp bigint DEFAULT 0 CHECK (farming_xp >= 0),
  hunting_xp bigint DEFAULT 0 CHECK (hunting_xp >= 0),
  smithing_xp bigint DEFAULT 0 CHECK (smithing_xp >= 0),
  cooking_xp bigint DEFAULT 0 CHECK (cooking_xp >= 0),
  alchemy_xp bigint DEFAULT 0 CHECK (alchemy_xp >= 0),
  construction_xp bigint DEFAULT 0 CHECK (construction_xp >= 0),
  luck_xp bigint DEFAULT 0 CHECK (luck_xp >= 0),
  attack_level integer DEFAULT 1 CHECK (attack_level >= 1 AND attack_level <= 99),
  strength_level integer DEFAULT 1 CHECK (strength_level >= 1 AND strength_level <= 99),
  defense_level integer DEFAULT 1 CHECK (defense_level >= 1 AND defense_level <= 99),
  projectiles_level integer DEFAULT 1 CHECK (projectiles_level >= 1 AND projectiles_level <= 99),
  vitality_level integer DEFAULT 1 CHECK (vitality_level >= 1 AND vitality_level <= 99),
  mining_level integer DEFAULT 1 CHECK (mining_level >= 1 AND mining_level <= 99),
  woodcutting_level integer DEFAULT 1 CHECK (woodcutting_level >= 1 AND woodcutting_level <= 99),
  fishing_level integer DEFAULT 1 CHECK (fishing_level >= 1 AND fishing_level <= 99),
  farming_level integer DEFAULT 1 CHECK (farming_level >= 1 AND farming_level <= 99),
  hunting_level integer DEFAULT 1 CHECK (hunting_level >= 1 AND hunting_level <= 99),
  smithing_level integer DEFAULT 1 CHECK (smithing_level >= 1 AND smithing_level <= 99),
  cooking_level integer DEFAULT 1 CHECK (cooking_level >= 1 AND cooking_level <= 99),
  alchemy_level integer DEFAULT 1 CHECK (alchemy_level >= 1 AND alchemy_level <= 99),
  construction_level integer DEFAULT 1 CHECK (construction_level >= 1 AND construction_level <= 99),
  luck_level integer DEFAULT 1 CHECK (luck_level >= 1 AND luck_level <= 99),
  CONSTRAINT player_skill_experience_pkey PRIMARY KEY (player_pda)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  player_pda text,
  wallet_address text UNIQUE,
  character_class integer DEFAULT 0,
  character_name text DEFAULT 'Unnamed Player'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  pda_created_at timestamp with time zone,
  pda_creation_cost numeric DEFAULT 0,
  pda_status text DEFAULT 'pending'::text CHECK (pda_status = ANY (ARRAY['pending'::text, 'creating'::text, 'active'::text, 'failed'::text])),
  cobx_token_account text,
  character_cnft_1 text,
  character_cnft_2 text,
  character_cnft_3 text,
  character_cnft_4 text,
  character_cnft_5 text,
  active_character_slot integer CHECK (active_character_slot >= 1 AND active_character_slot <= 5),
  username text,
  user_type text DEFAULT 'WEB2'::text CHECK (user_type = ANY (ARRAY['WEB2'::text, 'WEB3'::text, 'GUEST'::text])),
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.quests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  world_name text NOT NULL,
  title text NOT NULL,
  description text,
  quest_type text NOT NULL,
  min_level integer DEFAULT 1,
  repeatable boolean DEFAULT false,
  time_limit_ms bigint,
  rewards jsonb,
  config jsonb NOT NULL,
  giver_npc_id text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT quests_pkey PRIMARY KEY (id)
);
CREATE TABLE public.skill_training_logs (
  id integer NOT NULL DEFAULT nextval('skill_training_logs_id_seq'::regclass),
  asset_id character varying NOT NULL,
  action character varying NOT NULL,
  skill character varying NOT NULL,
  exp_gained integer NOT NULL CHECK (exp_gained > 0),
  player_pda character varying,
  session_id character varying,
  game_mode character varying,
  additional_data jsonb,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT skill_training_logs_pkey PRIMARY KEY (id),
  CONSTRAINT skill_training_logs_action_fkey FOREIGN KEY (action) REFERENCES public.action_skills(action)
);
CREATE TABLE public.xp_award_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  idempotency_key text UNIQUE,
  asset_id text NOT NULL,
  skill text NOT NULL,
  experience_gain integer NOT NULL CHECK (experience_gain > 0),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT xp_award_events_pkey PRIMARY KEY (id)
);